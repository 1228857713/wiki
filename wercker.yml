box: node:8-alpine
build:
  steps:
    - script:
      name: install dependencies
      code: |
        apk update
        apk add bash build-base curl git openssh yarn
    - script:
      name: yarn install
      code: |
        yarn config set cache-folder "$WERCKER_CACHE_DIR/yarn"
        yarn install
    - script:
      name: build
      code: yarn run build
    - npm-test
deploy:
  steps:
    - script:
      name: package
      code: |
        tar -czf wiki-js.tar.gz * -X .build/.deployexclude
        yarn install --production --ignore-scripts --prefer-offline
        tar -czf node_modules.tar.gz node_modules
